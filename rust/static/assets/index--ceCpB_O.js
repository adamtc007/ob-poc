(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const L=window.location.origin;class C extends Error{constructor(s,t){super(t),this.status=s,this.name="ApiError"}}async function u(e,s,t){const r={method:e,headers:{"Content-Type":"application/json"}};t!==void 0&&(r.body=JSON.stringify(t));const n=await fetch(`${L}${s}`,r);if(!n.ok)throw new C(n.status,`HTTP ${n.status}`);const i=await n.text();if(i)return JSON.parse(i)}const p={createSession(e={}){return u("POST","/api/session",e)},getSession(e){return u("GET",`/api/session/${e}`)},deleteSession(e){return u("DELETE",`/api/session/${e}`)},chat(e,s){return u("POST",`/api/session/${e}/chat`,s)},execute(e,s={}){return u("POST",`/api/session/${e}/execute`,s)},clear(e){return u("POST",`/api/session/${e}/clear`)}},D={sessionId:null,sessionState:null,messages:[],intents:[],validations:[],assembledDsl:[],canExecute:!1,loading:!1,error:null};let m={...D};const E=new Set;function v(){return m}function c(e){m={...m,...e},E.forEach(s=>s(m))}function T(e){return E.add(e),()=>E.delete(e)}function g(e){c({loading:e,error:null})}function x(e){c({error:e,loading:!1})}function B(e,s){c({sessionId:e,sessionState:s,messages:[],intents:[],validations:[],assembledDsl:[],canExecute:!1,error:null})}function f(e,s){const t={id:crypto.randomUUID(),role:e,content:s,timestamp:new Date().toISOString()};c({messages:[...m.messages,t]})}function O(e,s,t,r,n){c({intents:e,validations:s,assembledDsl:t,sessionState:r,canExecute:n,loading:!1})}function $(){c({intents:[],validations:[],assembledDsl:[],canExecute:!1})}function a(e){const s=document.getElementById(e);if(!s)throw new Error(`Element not found: ${e}`);return s}function d(e){const s=document.createElement("div");return s.textContent=e,s.innerHTML}function M(e){return typeof e=="object"?JSON.stringify(e):String(e)}function H(e){const s=a("session-info"),t=a("session-state");e.sessionId?(s.textContent=`Session: ${e.sessionId.substring(0,8)}...`,s.className="session-info active"):(s.textContent="No active session",s.className="session-info"),e.sessionState?(t.textContent=e.sessionState.replace(/_/g," "),t.className=`session-state ${e.sessionState}`,t.style.display="inline-block"):t.style.display="none"}function P(e){const s=a("chat");if(e.messages.length===0){s.innerHTML='<div class="empty-state">Create a session to start chatting</div>';return}s.innerHTML=e.messages.map(t=>`
      <div class="message ${t.role}">
        <div class="message-role">${t.role==="user"?"You":"Agent"}</div>
        <div class="message-content">${t.content}</div>
      </div>
    `).join(""),s.scrollTop=s.scrollHeight}function k(e){const s=a("intents-panel"),t=a("intent-count");if(e.intents.length===0){s.innerHTML='<div class="empty-state">Intents will appear here</div>',t.style.display="none";return}t.textContent=String(e.intents.length),t.style.display="inline-block",s.innerHTML=e.intents.map((r,n)=>N(r,e.validations[n])).join("")}function N(e,s){let n=`<div class="intent-card ${(s==null?void 0:s.valid)??!0?"valid":"invalid"}">`;n+=`<div class="intent-verb">${d(e.verb)}</div>`;const i=Object.entries(e.params);if(i.length>0){n+='<div class="intent-params">';for(const[l,h]of i)n+=`
        <div class="intent-param">
          <span class="intent-param-key">:${d(l)}</span>
          <span class="intent-param-value">${d(M(h))}</span>
        </div>
      `;n+="</div>"}const o=Object.entries(e.refs);if(o.length>0){n+='<div class="intent-refs">';for(const[l,h]of o)n+=`<span class="intent-ref">:${d(l)} = ${d(h)}</span> `;n+="</div>"}return s&&!s.valid&&s.errors.length>0&&(n+='<div class="validation-errors">',n+=s.errors.map(l=>d(l.message)).join("<br>"),n+="</div>"),n+="</div>",n}function _(e){const s=a("dsl-preview"),t=a("dsl-count");if(e.assembledDsl.length===0){s.innerHTML='<div class="empty-state" style="color: #666;">DSL will appear here</div>',t.style.display="none";return}t.textContent=String(e.assembledDsl.length),t.style.display="inline-block",s.innerHTML=e.assembledDsl.map((r,n)=>`
      <div class="dsl-item">
        <span class="dsl-comment"># Statement ${n+1}</span>
        <pre class="dsl-code">${d(r)}</pre>
      </div>
    `).join("")}function j(e){const s=a("message"),t=a("send-btn"),r=a("execute-btn"),n=a("clear-btn"),i=e.sessionId!==null,o=e.loading;s.disabled=!i||o,t.disabled=!i||o,r.disabled=!e.canExecute||o,n.disabled=e.assembledDsl.length===0||o,o?r.textContent="Executing...":r.textContent="Execute All DSL"}function A(){const e=a("chat"),s=document.createElement("div");s.id="loading-message",s.className="message agent loading",s.innerHTML='<div class="message-role">Agent</div><div class="message-content">Extracting intents...</div>',e.appendChild(s),e.scrollTop=e.scrollHeight}function S(){const e=document.getElementById("loading-message");e&&e.remove()}function y(e){const s=a("chat"),t=document.createElement("div");t.className="message agent",t.innerHTML=`
    <div class="message-role">Agent</div>
    <div class="message-content error-message">${d(e)}</div>
  `,s.appendChild(t),s.scrollTop=s.scrollHeight}function b(e){H(e),P(e),k(e),_(e),j(e)}async function U(){try{g(!0);const e=await p.createSession({});B(e.session_id,e.state),f("agent","Session started. Describe what you want to create!")}catch(e){const s=e instanceof Error?e.message:"Unknown error";x(`Failed to create session: ${s}`),y(`Failed to create session: ${s}`)}finally{g(!1)}}async function w(){var r;const e=v();if(!e.sessionId){alert("Create a session first");return}const s=document.getElementById("message"),t=s.value.trim();if(t){s.value="",f("user",t),A(),g(!0);try{const n=await p.chat(e.sessionId,{message:t});S();let i=n.message;if(n.intents.length>0){const o=n.validation_results.filter(I=>I.valid).length,l=n.intents.length;i+=` <span class="badge ${o===l?"valid":"invalid"}">${o}/${l} valid</span>`}f("agent",i),O(n.intents,n.validation_results,((r=n.assembled_dsl)==null?void 0:r.statements)??[],n.session_state,n.can_execute)}catch(n){S();const i=n instanceof Error?n.message:"Unknown error";x(i),y(i)}}}async function F(){const e=v();if(!(!e.sessionId||!e.canExecute)){g(!0);try{const s=await p.execute(e.sessionId,{dry_run:!1});if(s.success)f("agent",`<span class="success-message">Successfully executed ${s.results.length} DSL statement(s)</span>`),$();else{const t=s.errors.join("<br>");f("agent",`<span class="error-message">Execution failed:<br>${t}</span>`)}c({sessionState:s.new_state}),await J()}catch(s){const t=s instanceof Error?s.message:"Unknown error";y(`Execution error: ${t}`)}finally{g(!1)}}}async function q(){const e=v();if(e.sessionId)try{const s=await p.clear(e.sessionId);$(),c({sessionState:s.state}),f("agent","DSL cleared.")}catch(s){const t=s instanceof Error?s.message:"Unknown error";y(`Error: ${t}`)}}async function J(){const e=v();if(e.sessionId)try{const s=await p.getSession(e.sessionId);c({assembledDsl:s.assembled_dsl,sessionState:s.state,canExecute:s.can_execute})}catch(s){console.error("Failed to refresh session state:",s)}}function V(){const e=document.querySelector(".new-session-btn");e&&e.addEventListener("click",U);const s=document.getElementById("send-btn");s&&s.addEventListener("click",w);const t=document.getElementById("message");t&&t.addEventListener("keypress",i=>{i.key==="Enter"&&w()});const r=document.getElementById("execute-btn");r&&r.addEventListener("click",F);const n=document.getElementById("clear-btn");n&&n.addEventListener("click",q)}function G(){T(b),V(),b(v());const e=document.getElementById("message");e&&e.focus()}document.addEventListener("DOMContentLoaded",G);
