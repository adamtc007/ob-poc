# Cash Sweep Configuration Verbs
# =============================================================================
# Manages cash sweep and STIF configuration
# =============================================================================

domains:
  cash-sweep:
    description: "Cash sweep and STIF configuration management"
    verbs:
      configure:
        description: Configure cash sweep for currency
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: upsert
          table: cbu_cash_sweep_config
          schema: custody
          conflict_keys:
            - cbu_id
            - currency
          returning: sweep_id
        args:
          - name: cbu-id
            type: uuid
            required: true
            maps_to: cbu_id
            lookup:
              table: cbus
              entity_type: cbu
              schema: ob-poc
              search_key: name
              primary_key: cbu_id
          - name: profile-id
            type: uuid
            required: false
            maps_to: profile_id
            lookup:
              table: cbu_trading_profiles
              schema: ob-poc
              search_key: profile_id
              primary_key: profile_id
          - name: currency
            type: string
            required: true
            maps_to: currency
          - name: threshold-amount
            type: decimal
            required: true
            maps_to: threshold_amount
          - name: vehicle-type
            type: string
            required: true
            maps_to: vehicle_type
            valid_values:
              - STIF
              - MMF
              - DEPOSIT
              - OVERNIGHT_REPO
              - TRI_PARTY_REPO
              - MANUAL
          - name: vehicle-id
            type: string
            required: false
            maps_to: vehicle_id
          - name: vehicle-name
            type: string
            required: false
            maps_to: vehicle_name
          - name: sweep-time
            type: string
            required: true
            maps_to: sweep_time
            description: Time in HH:MM format
          - name: sweep-timezone
            type: string
            required: true
            maps_to: sweep_timezone
            description: IANA timezone (e.g., Europe/Luxembourg)
          - name: sweep-frequency
            type: string
            required: false
            default: DAILY
            maps_to: sweep_frequency
            valid_values:
              - INTRADAY
              - DAILY
              - WEEKLY
              - MONTHLY
          - name: interest-allocation
            type: string
            required: false
            default: ACCRUED
            maps_to: interest_allocation
            valid_values:
              - ACCRUED
              - MONTHLY
              - QUARTERLY
              - REINVEST
          - name: effective-date
            type: date
            required: false
            maps_to: effective_date
        returns:
          type: uuid
          name: sweep_id
          capture: true

      link-resource:
        description: Link sweep config to cash management resource
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
          - name: sweep-resource-id
            type: uuid
            required: true
            maps_to: sweep_resource_id
            lookup:
              table: cbu_resource_instances
              entity_type: resource_instance
              schema: ob-poc
              search_key: instance_name
              primary_key: instance_id
        returns:
          type: affected

      list:
        description: List cash sweep configurations for CBU
        metadata:
          tier: reference
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: list_by_fk
          table: cbu_cash_sweep_config
          schema: custody
          fk_col: cbu_id
        args:
          - name: cbu-id
            type: uuid
            required: true
            lookup:
              table: cbus
              entity_type: cbu
              schema: ob-poc
              search_key: name
              primary_key: cbu_id
          - name: is-active
            type: boolean
            required: false
            default: true
            maps_to: is_active
        returns:
          type: record_set

      update-threshold:
        description: Update sweep threshold amount
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
          - name: threshold-amount
            type: decimal
            required: true
            maps_to: threshold_amount
        returns:
          type: affected

      update-timing:
        description: Update sweep timing
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
          - name: sweep-time
            type: string
            required: false
            maps_to: sweep_time
          - name: sweep-timezone
            type: string
            required: false
            maps_to: sweep_timezone
          - name: sweep-frequency
            type: string
            required: false
            maps_to: sweep_frequency
            valid_values:
              - INTRADAY
              - DAILY
              - WEEKLY
              - MONTHLY
        returns:
          type: affected

      change-vehicle:
        description: Change sweep investment vehicle
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
          - name: vehicle-type
            type: string
            required: true
            maps_to: vehicle_type
            valid_values:
              - STIF
              - MMF
              - DEPOSIT
              - OVERNIGHT_REPO
              - TRI_PARTY_REPO
              - MANUAL
          - name: vehicle-id
            type: string
            required: false
            maps_to: vehicle_id
          - name: vehicle-name
            type: string
            required: false
            maps_to: vehicle_name
        returns:
          type: affected

      suspend:
        description: Suspend cash sweep
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
          set_values:
            is_active: false
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
        returns:
          type: affected

      reactivate:
        description: Reactivate cash sweep
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: update
          table: cbu_cash_sweep_config
          schema: custody
          key: sweep_id
          set_values:
            is_active: true
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
        returns:
          type: affected

      remove:
        description: Remove cash sweep configuration
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: cash_sweep
        behavior: crud
        crud:
          operation: delete
          table: cbu_cash_sweep_config
          schema: custody
        args:
          - name: sweep-id
            type: uuid
            required: true
            maps_to: sweep_id
        returns:
          type: affected
