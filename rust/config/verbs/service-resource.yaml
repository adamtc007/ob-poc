domains:
  service-resource:
    description: "Service resource type (read-only) and instance operations"
    verbs:
      # === Type Operations (read-only - reference data) ===
      read:
        description: Read a service resource type by ID or code
        behavior: crud
        crud:
          operation: select
          table: service_resource_types
          schema: ob-poc
        args:
          - name: resource-id
            type: uuid
            required: false
            maps_to: resource_id
            lookup:
              table: service_resource_types
              entity_type: resource_type
              schema: ob-poc
              search_key: name
              primary_key: resource_type_id
          - name: resource-code
            type: string
            required: false
            maps_to: resource_code
        returns:
          type: record

      list:
        description: List service resource types with optional filters
        behavior: crud
        crud:
          operation: select
          table: service_resource_types
          schema: ob-poc
        args:
          - name: resource-type
            type: string
            required: false
            maps_to: resource_type
          - name: owner
            type: string
            required: false
            maps_to: owner
          - name: is-active
            type: boolean
            required: false
            maps_to: is_active
          - name: limit
            type: integer
            required: false
            default: 100
          - name: offset
            type: integer
            required: false
            default: 0
        returns:
          type: record_set

      # === Taxonomy lookups (read-only - taxonomy managed separately) ===
      list-by-service:
        description: List service resource types for a service
        behavior: crud
        crud:
          operation: select_with_join
          primary_table: service_resource_types
          join_table: service_resources
          join_col: resource_id
          filter_col: service_id
          schema: ob-poc
        args:
          - name: service-id
            type: uuid
            required: true
            lookup:
              table: services
              entity_type: service
              schema: ob-poc
              search_key: name
              primary_key: service_id
        returns:
          type: record_set

      # === Attribute lookups (read-only - attribute requirements managed separately) ===
      list-attributes:
        description: List attribute requirements for a service resource type
        behavior: crud
        crud:
          operation: list_by_fk
          table: resource_attribute_requirements
          schema: ob-poc
          fk_col: resource_id
        args:
          - name: resource-id
            type: uuid
            required: true
            lookup:
              table: service_resource_types
              entity_type: resource_type
              schema: ob-poc
              search_key: name
              primary_key: resource_type_id
          - name: is-mandatory
            type: boolean
            required: false
        returns:
          type: record_set

      # === Instance Operations (provisioning and lifecycle) ===
      provision:
        description: Provision a service resource instance for a CBU
        behavior: plugin
        handler: resource_instance_create
        args:
          - name: cbu-id
            type: uuid
            required: true
            lookup:
              table: cbus
              entity_type: cbu
              schema: ob-poc
              search_key: name
              primary_key: cbu_id
          - name: resource-type
            type: string
            required: true
          - name: instance-url
            type: string
            required: true
          - name: instance-id
            type: string
            required: false
          - name: instance-name
            type: string
            required: false
          - name: product-id
            type: uuid
            required: false
            lookup:
              table: products
              entity_type: product
              schema: ob-poc
              search_key: name
              primary_key: product_id
          - name: service-id
            type: uuid
            required: false
            lookup:
              table: services
              entity_type: service
              schema: ob-poc
              search_key: name
              primary_key: service_id
          - name: config
            type: json
            required: false
        returns:
          type: uuid
          name: instance_id
          capture: true

      set-attr:
        description: Set an attribute value on a service resource instance
        behavior: plugin
        handler: resource_set_attr
        args:
          - name: instance-id
            type: uuid
            required: true
            lookup:
              table: cbu_resource_instances
              entity_type: resource_instance
              schema: ob-poc
              search_key: instance_name
              primary_key: instance_id
          - name: attr
            type: string
            required: true
          - name: value
            type: string
            required: true
          - name: state
            type: string
            required: false
            valid_values:
              - proposed
              - confirmed
              - derived
              - system
          - name: source
            type: json
            required: false

      activate:
        description: Activate a service resource instance
        behavior: plugin
        handler: resource_activate
        args:
          - name: instance-id
            type: uuid
            required: true

      suspend:
        description: Suspend a service resource instance
        behavior: plugin
        handler: resource_suspend
        args:
          - name: instance-id
            type: uuid
            required: true
            lookup:
              table: cbu_resource_instances
              entity_type: resource_instance
              schema: ob-poc
              search_key: instance_name
              primary_key: instance_id
          - name: reason
            type: string
            required: false

      decommission:
        description: Decommission a service resource instance
        behavior: plugin
        handler: resource_decommission
        args:
          - name: instance-id
            type: uuid
            required: true
            lookup:
              table: cbu_resource_instances
              entity_type: resource_instance
              schema: ob-poc
              search_key: instance_name
              primary_key: instance_id
          - name: reason
            type: string
            required: false

      validate-attrs:
        description: Validate that all required attributes are set for a resource instance
        behavior: plugin
        handler: resource_validate_attrs
        args:
          - name: instance-id
            type: uuid
            required: true
            lookup:
              table: cbu_resource_instances
              entity_type: resource_instance
              schema: ob-poc
              search_key: instance_name
              primary_key: instance_id
        returns:
          type: record
          name: validation_result
