domains:
  service-resource:
    description: Service resource type and instance operations
    verbs:
      create:
        description: Create a new service resource type
        behavior: crud
        crud:
          operation: insert
          table: service_resource_types
          schema: ob-poc
          returning: resource_id
        args:
        - name: name
          type: string
          required: true
          maps_to: name
        - name: resource-code
          type: string
          required: true
          maps_to: resource_code
        - name: owner
          type: string
          required: true
          maps_to: owner
        - name: description
          type: string
          required: false
          maps_to: description
        - name: resource-type
          type: string
          required: false
          maps_to: resource_type
        - name: vendor
          type: string
          required: false
          maps_to: vendor
        - name: api-endpoint
          type: string
          required: false
          maps_to: api_endpoint
        - name: capabilities
          type: json
          required: false
          maps_to: capabilities
        returns:
          type: uuid
          name: resource_id
          capture: true
      read:
        description: Read a service resource type by ID or code
        behavior: crud
        crud:
          operation: select
          table: service_resource_types
          schema: ob-poc
        args:
        - name: resource-id
          type: uuid
          required: false
          maps_to: resource_id
        - name: resource-code
          type: string
          required: false
          maps_to: resource_code
        returns:
          type: record
      update:
        description: Update a service resource type
        behavior: crud
        crud:
          operation: update
          table: service_resource_types
          schema: ob-poc
          key: resource_id
        args:
        - name: resource-id
          type: uuid
          required: true
          maps_to: resource_id
        - name: name
          type: string
          required: false
          maps_to: name
        - name: description
          type: string
          required: false
          maps_to: description
        - name: is-active
          type: boolean
          required: false
          maps_to: is_active
        - name: api-endpoint
          type: string
          required: false
          maps_to: api_endpoint
        - name: capabilities
          type: json
          required: false
          maps_to: capabilities
        returns:
          type: affected
      delete:
        description: Delete a service resource type
        behavior: crud
        crud:
          operation: delete
          table: service_resource_types
          schema: ob-poc
          key: resource_id
        args:
        - name: resource-id
          type: uuid
          required: true
          maps_to: resource_id
        returns:
          type: affected
      list:
        description: List service resource types with optional filters
        behavior: crud
        crud:
          operation: select
          table: service_resource_types
          schema: ob-poc
        args:
        - name: resource-type
          type: string
          required: false
          maps_to: resource_type
        - name: owner
          type: string
          required: false
          maps_to: owner
        - name: is-active
          type: boolean
          required: false
          maps_to: is_active
        - name: limit
          type: integer
          required: false
          default: 100
        - name: offset
          type: integer
          required: false
          default: 0
        returns:
          type: record_set
      ensure:
        description: Create or update a service resource type by resource-code
        behavior: crud
        crud:
          operation: upsert
          table: service_resource_types
          schema: ob-poc
          conflict_keys:
          - resource_code
          returning: resource_id
        args:
        - name: name
          type: string
          required: true
          maps_to: name
        - name: resource-code
          type: string
          required: true
          maps_to: resource_code
        - name: owner
          type: string
          required: true
          maps_to: owner
        - name: description
          type: string
          required: false
          maps_to: description
        - name: resource-type
          type: string
          required: false
          maps_to: resource_type
        - name: vendor
          type: string
          required: false
          maps_to: vendor
        returns:
          type: uuid
          name: resource_id
          capture: true
      link-service:
        description: Link a service resource type to a service
        behavior: crud
        crud:
          operation: link
          junction: service_resources
          schema: ob-poc
          from_col: resource_id
          to_col: service_id
        args:
        - name: resource-id
          type: uuid
          required: true
          maps_to: resource_id
        - name: service-id
          type: uuid
          required: true
          maps_to: service_id
        - name: is-primary
          type: boolean
          required: false
          maps_to: is_primary
        returns:
          type: void
      unlink-service:
        description: Unlink a service resource type from a service
        behavior: crud
        crud:
          operation: unlink
          junction: service_resources
          schema: ob-poc
          from_col: resource_id
          to_col: service_id
        args:
        - name: resource-id
          type: uuid
          required: true
        - name: service-id
          type: uuid
          required: true
        returns:
          type: affected
      list-by-service:
        description: List service resource types for a service
        behavior: crud
        crud:
          operation: select_with_join
          primary_table: service_resource_types
          join_table: service_resources
          join_col: resource_id
          filter_col: service_id
          schema: ob-poc
        args:
        - name: service-id
          type: uuid
          required: true
        returns:
          type: record_set
      add-attribute:
        description: Add an attribute requirement to a service resource type
        behavior: crud
        crud:
          operation: insert
          table: resource_attribute_requirements
          schema: ob-poc
          returning: requirement_id
        args:
        - name: resource-id
          type: uuid
          required: true
          maps_to: resource_id
        - name: attribute-id
          type: uuid
          required: true
          maps_to: attribute_id
        - name: resource-field-name
          type: string
          required: false
          maps_to: resource_field_name
        - name: is-mandatory
          type: boolean
          required: false
          maps_to: is_mandatory
          default: true
        - name: transformation-rule
          type: json
          required: false
          maps_to: transformation_rule
        - name: validation-override
          type: json
          required: false
          maps_to: validation_override
        - name: default-value
          type: string
          required: false
          maps_to: default_value
        - name: display-order
          type: integer
          required: false
          maps_to: display_order
        returns:
          type: uuid
          name: requirement_id
          capture: false
      remove-attribute:
        description: Remove an attribute requirement from a service resource type
        behavior: crud
        crud:
          operation: delete
          table: resource_attribute_requirements
          schema: ob-poc
          key: requirement_id
        args:
        - name: requirement-id
          type: uuid
          required: true
          maps_to: requirement_id
        returns:
          type: affected
      update-attribute:
        description: Update an attribute requirement configuration
        behavior: crud
        crud:
          operation: update
          table: resource_attribute_requirements
          schema: ob-poc
          key: requirement_id
        args:
        - name: requirement-id
          type: uuid
          required: true
          maps_to: requirement_id
        - name: resource-field-name
          type: string
          required: false
          maps_to: resource_field_name
        - name: is-mandatory
          type: boolean
          required: false
          maps_to: is_mandatory
        - name: transformation-rule
          type: json
          required: false
          maps_to: transformation_rule
        - name: validation-override
          type: json
          required: false
          maps_to: validation_override
        - name: default-value
          type: string
          required: false
          maps_to: default_value
        - name: display-order
          type: integer
          required: false
          maps_to: display_order
        returns:
          type: affected
      list-attributes:
        description: List attribute requirements for a service resource type
        behavior: crud
        crud:
          operation: list_by_fk
          table: resource_attribute_requirements
          schema: ob-poc
          fk_col: resource_id
        args:
        - name: resource-id
          type: uuid
          required: true
        - name: is-mandatory
          type: boolean
          required: false
        returns:
          type: record_set
      ensure-attribute:
        description: Ensure an attribute requirement exists (upsert)
        behavior: crud
        crud:
          operation: upsert
          table: resource_attribute_requirements
          schema: ob-poc
          conflict_keys:
          - resource_id
          - attribute_id
          returning: requirement_id
        args:
        - name: resource-id
          type: uuid
          required: true
          maps_to: resource_id
        - name: attribute-id
          type: uuid
          required: true
          maps_to: attribute_id
        - name: resource-field-name
          type: string
          required: false
          maps_to: resource_field_name
        - name: is-mandatory
          type: boolean
          required: false
          maps_to: is_mandatory
        - name: transformation-rule
          type: json
          required: false
          maps_to: transformation_rule
        - name: validation-override
          type: json
          required: false
          maps_to: validation_override
        - name: default-value
          type: string
          required: false
          maps_to: default_value
        - name: display-order
          type: integer
          required: false
          maps_to: display_order
        returns:
          type: uuid
          name: requirement_id
          capture: false
      provision:
        description: Provision a service resource instance for a CBU
        behavior: plugin
        handler: resource_instance_create
        args:
        - name: cbu-id
          type: uuid
          required: true
        - name: resource-type
          type: string
          required: true
        - name: instance-url
          type: string
          required: true
        - name: instance-id
          type: string
          required: false
        - name: instance-name
          type: string
          required: false
        - name: product-id
          type: uuid
          required: false
        - name: service-id
          type: uuid
          required: false
        - name: config
          type: json
          required: false
        returns:
          type: uuid
          name: instance_id
          capture: true
      set-attr:
        description: Set an attribute value on a service resource instance
        behavior: plugin
        handler: resource_set_attr
        args:
        - name: instance-id
          type: uuid
          required: true
        - name: attr
          type: string
          required: true
        - name: value
          type: string
          required: true
        - name: state
          type: string
          required: false
          valid_values:
          - proposed
          - confirmed
          - derived
          - system
        - name: source
          type: json
          required: false
      activate:
        description: Activate a service resource instance
        behavior: plugin
        handler: resource_activate
        args:
        - name: instance-id
          type: uuid
          required: true
      suspend:
        description: Suspend a service resource instance
        behavior: plugin
        handler: resource_suspend
        args:
        - name: instance-id
          type: uuid
          required: true
        - name: reason
          type: string
          required: false
      decommission:
        description: Decommission a service resource instance
        behavior: plugin
        handler: resource_decommission
        args:
        - name: instance-id
          type: uuid
          required: true
        - name: reason
          type: string
          required: false
      validate-attrs:
        description: Validate that all required attributes are set for a resource instance
        behavior: plugin
        handler: resource_validate_attrs
        args:
        - name: instance-id
          type: uuid
          required: true
        returns:
          type: record
          name: validation_result
