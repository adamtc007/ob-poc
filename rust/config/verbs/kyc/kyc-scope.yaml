# KYC Scope and Sponsor Decision Verbs
# For intelligent KYC scoping and KYC-as-a-Service workflows

domains:
  kyc:
    description: "KYC scope preview and sponsor workflows"
    verbs:
      preview-scope:
        description: "Preview KYC scope for a CBU - shows entities and their obligations"
        behavior: plugin
        plugin:
          handler: KycPreviewScopeOp
        args:
          - name: cbu-id
            type: uuid
            required: true
            lookup:
              entity_type: cbu
              table: cbus
              schema: ob-poc
              search_key: name
              primary_key: cbu_id
          - name: service-context
            type: string
            required: false
            description: "CUSTODY, TRANSFER_AGENT, BROKER_DEALER, KYC_AS_A_SERVICE"
          - name: products
            type: string_list
            required: false
            description: "Products being onboarded (for risk rating calculation)"
        returns:
          type: record
          description: |
            Returns scoped entities with their KYC obligations:
            - cbu_type, service_context, case_risk_rating
            - entities: [{entity_id, name, role, is_regulated, kyc_obligation, reason}]
            - summary: {full_kyc_count, simplified_count, screen_and_id_count}

      recommend:
        description: "Record our KYC recommendation (for KYC-aaS cases)"
        behavior: plugin
        plugin:
          handler: KycRecommendOp
        args:
          - name: case-id
            type: uuid
            required: true
            lookup:
              entity_type: kyc_case
              table: cases
              schema: kyc
              search_key: case_id
              primary_key: case_id
          - name: recommendation
            type: string
            required: true
            description: "APPROVE, REJECT, REFER"
          - name: risk-rating
            type: string
            required: true
            description: "LOW, MEDIUM, HIGH"
          - name: findings
            type: json
            required: false
            description: "Structured findings JSON"
          - name: notes
            type: string
            required: false
        returns:
          type: uuid
          capture: true

      sponsor-decision:
        description: "Record sponsor's decision on KYC case"
        behavior: plugin
        plugin:
          handler: KycSponsorDecisionOp
        args:
          - name: case-id
            type: uuid
            required: true
            lookup:
              entity_type: kyc_case
              table: cases
              schema: kyc
              search_key: case_id
              primary_key: case_id
          - name: decision
            type: string
            required: true
            description: "ACCEPTED, REJECTED, ESCALATED, DEFERRED"
          - name: decided-by
            type: string
            required: true
            description: "Name or ID of sponsor decision maker"
          - name: comments
            type: string
            required: false
        returns:
          type: uuid
          capture: true
