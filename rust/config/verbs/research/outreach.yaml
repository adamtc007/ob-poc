domains:
  research.outreach:
    description: "Counterparty outreach tracking for ownership disclosures and information requests"

    invocation_hints:
      - "outreach"
      - "request information"
      - "ask the counterparty"
      - "send a disclosure request"
      - "ownership disclosure"
      - "waiting for response"
      - "chase the client"
      - "overdue requests"

    verbs:
      # =======================================================================
      # REQUEST MANAGEMENT
      # =======================================================================

      create-request:
        description: "Create an outreach request"
        invocation_phrases:
          - "create outreach request"
          - "request ownership disclosure"
          - "ask for information"
          - "send a request to"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [write, workflow, request-management]
        behavior: crud
        crud:
          operation: insert
          table: outreach_requests
          schema: kyc
          returning: request_id
        args:
          - name: target-entity-id
            type: uuid
            required: true
            maps_to: target_entity_id
            lookup:
              table: entities
              entity_type: entity
              schema: ob-poc
              search_key: name
              primary_key: entity_id
          - name: request-type
            type: string
            required: true
            maps_to: request_type
          - name: recipient-entity-id
            type: uuid
            required: false
            maps_to: recipient_entity_id
            lookup:
              table: entities
              entity_type: entity
              schema: ob-poc
              search_key: name
              primary_key: entity_id
          - name: recipient-email
            type: string
            required: false
            maps_to: recipient_email
          - name: recipient-name
            type: string
            required: false
            maps_to: recipient_name
          - name: deadline-days
            type: integer
            required: false
            description: "Number of days until deadline (default 30)"
          - name: request-notes
            type: string
            required: false
            maps_to: request_notes
          - name: trigger-id
            type: uuid
            required: false
            maps_to: trigger_id
        returns:
          type: uuid
          capture: true

      mark-sent:
        description: "Mark request as sent"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [write, workflow, status-update]
        behavior: crud
        crud:
          operation: update
          table: outreach_requests
          schema: kyc
        args:
          - name: request-id
            type: uuid
            required: true
            maps_to: request_id
          - name: status
            type: string
            required: false
            default: "SENT"
            maps_to: status
        returns:
          type: affected

      send-reminder:
        description: "Mark that a reminder was sent"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [write, workflow, status-update]
        behavior: crud
        crud:
          operation: update
          table: outreach_requests
          schema: kyc
        args:
          - name: request-id
            type: uuid
            required: true
            maps_to: request_id
          - name: status
            type: string
            required: false
            default: "REMINDED"
            maps_to: status
        returns:
          type: affected

      record-response:
        description: "Record response to outreach request"
        invocation_phrases:
          - "record the response"
          - "they responded"
          - "got a disclosure"
          - "received ownership information"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_response
          tags: [write, workflow, response-capture]
        behavior: plugin
        handler: OutreachRecordResponseOp
        args:
          - name: request-id
            type: uuid
            required: true
          - name: response-type
            type: string
            required: true
            valid_values:
              - FULL_DISCLOSURE
              - PARTIAL_DISCLOSURE
              - DECLINED
              - NO_RESPONSE
          - name: document-id
            type: uuid
            required: false
          - name: notes
            type: string
            required: false
        returns:
          type: record

      close-request:
        description: "Close an outreach request"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [write, workflow, status-update]
        behavior: crud
        crud:
          operation: update
          table: outreach_requests
          schema: kyc
        args:
          - name: request-id
            type: uuid
            required: true
            maps_to: request_id
          - name: status
            type: string
            required: false
            default: "CLOSED"
            maps_to: status
          - name: resolution-notes
            type: string
            required: false
            maps_to: resolution_notes
        returns:
          type: affected

      # =======================================================================
      # QUERIES
      # =======================================================================

      list-pending:
        description: "List pending outreach requests"
        metadata:
          tier: diagnostics
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [read, query, workflow]
        behavior: crud
        crud:
          operation: select
          table: outreach_requests
          schema: kyc
        args:
          - name: target-entity-id
            type: uuid
            required: false
            maps_to: target_entity_id
          - name: status
            type: string
            required: false
            maps_to: status
            default: "PENDING"
          - name: request-type
            type: string
            required: false
            maps_to: request_type
        returns:
          type: record_set

      list-overdue:
        description: "List overdue outreach requests"
        invocation_phrases:
          - "show overdue requests"
          - "what's overdue"
          - "pending outreach"
          - "who hasn't responded"
        metadata:
          tier: diagnostics
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [read, query, workflow, validation]
        behavior: plugin
        handler: OutreachListOverdueOp
        args:
          - name: days-overdue
            type: integer
            required: false
            default: 0
        returns:
          type: record_set

      get-request:
        description: "Get details of a specific request"
        metadata:
          tier: diagnostics
          source_of_truth: workflow
          scope: global
          noun: outreach_request
          tags: [read, query, workflow]
        behavior: crud
        crud:
          operation: select
          table: outreach_requests
          schema: kyc
        args:
          - name: request-id
            type: uuid
            required: true
            maps_to: request_id
        returns:
          type: record

      # =======================================================================
      # PLAN GENERATION (KYC/UBO Computed Architecture)
      # =======================================================================

      plan-generate:
        description: "Generate outreach plan from coverage gaps and UBO candidates"
        invocation_phrases:
          - "generate outreach plan"
          - "create outreach plan"
          - "plan outreach"
          - "generate document requests"
          - "build outreach plan from gaps"
        metadata:
          tier: intent
          source_of_truth: workflow
          scope: global
          noun: outreach_plan
          tags: [write, workflow, plan-generation]
        behavior: plugin
        plugin:
          handler: OutreachPlanGenerateOp
        args:
          - name: case-id
            type: uuid
            required: true
            description: "KYC case to generate plan for"
            lookup:
              table: cases
              schema: kyc
              search_key: case_id
              primary_key: case_id
          - name: determination-run-id
            type: uuid
            required: true
            description: "Determination run whose coverage gaps to use"
          - name: doc-preference
            type: string
            required: false
            description: "Use 'fallback' to request alternative document types"
            valid_values:
              - primary
              - fallback
        returns:
          type: record
          capture: true
          fields:
            - name: plan_id
              type: uuid
            - name: case_id
              type: uuid
            - name: items_count
              type: integer
            - name: items
              type: array
              description: "Outreach items with gap_ref, doc_type, status"
