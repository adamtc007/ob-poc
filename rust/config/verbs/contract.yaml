domains:
  contract:
    description: "Legal contract management - master service agreements with product-level rate cards"

    invocation_hints:
      - "contract"
      - "agreement"
      - "rate card"
      - "pricing"

    verbs:
      # =========================================================================
      # CONTRACT CRUD
      # =========================================================================

      create:
        description: "Create a new legal contract for a client"
        behavior: crud
        crud:
          operation: insert
          table: legal_contracts
          schema: ob-poc
          returning: contract_id
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "create contract"
          - "new contract"
          - "add contract"
          - "create legal agreement"
          - "new master service agreement"
        args:
          - name: client
            type: string
            required: true
            maps_to: client_label
            description: "Client label (e.g., 'allianz', 'blackrock')"
          - name: reference
            type: string
            required: false
            maps_to: contract_reference
            description: "External contract reference number"
          - name: effective-date
            type: date
            required: true
            maps_to: effective_date
            description: "Contract effective date"
          - name: status
            type: string
            required: false
            maps_to: status
            default: "ACTIVE"
            valid_values: [DRAFT, ACTIVE, TERMINATED, EXPIRED]
        returns:
          type: uuid
          name: contract_id
          capture: true

      get:
        description: "Get contract details by ID"
        behavior: crud
        crud:
          operation: select
          table: legal_contracts
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "get contract"
          - "show contract"
          - "contract details"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
        returns:
          type: record

      list:
        description: "List contracts, optionally filtered by client"
        behavior: crud
        crud:
          operation: select
          table: v_contract_summary
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "list contracts"
          - "show contracts"
          - "all contracts"
          - "contracts for client"
        args:
          - name: client
            type: string
            required: false
            maps_to: client_label
            description: "Filter by client label"
          - name: status
            type: string
            required: false
            maps_to: status
            valid_values: [DRAFT, ACTIVE, TERMINATED, EXPIRED]
        returns:
          type: record_set

      update:
        description: "Update contract details"
        behavior: crud
        crud:
          operation: update
          table: legal_contracts
          schema: ob-poc
          key: contract_id
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "update contract"
          - "modify contract"
          - "change contract status"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: status
            type: string
            required: false
            maps_to: status
            valid_values: [DRAFT, ACTIVE, TERMINATED, EXPIRED]
          - name: termination-date
            type: date
            required: false
            maps_to: termination_date
        returns:
          type: affected

      terminate:
        description: "Terminate a contract"
        behavior: crud
        crud:
          operation: update
          table: legal_contracts
          schema: ob-poc
          key: contract_id
          set_values:
            status: "TERMINATED"
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "terminate contract"
          - "end contract"
          - "cancel contract"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: termination-date
            type: date
            required: false
            maps_to: termination_date
        returns:
          type: affected

      # =========================================================================
      # CONTRACT PRODUCTS
      # =========================================================================

      add-product:
        description: "Add a product to a contract with rate card"
        behavior: crud
        crud:
          operation: insert
          table: contract_products
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract_product
        invocation_phrases:
          - "add product to contract"
          - "add contract product"
          - "assign rate card"
          - "add custody to contract"
          - "add fund admin to contract"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: product
            type: string
            required: true
            maps_to: product_code
            description: "Product code (e.g., CUSTODY, FUND_ADMIN, TRANSFER_AGENCY)"
          - name: rate-card-id
            type: uuid
            required: false
            maps_to: rate_card_id
          - name: effective-date
            type: date
            required: false
            maps_to: effective_date
        returns:
          type: affected

      remove-product:
        description: "Remove a product from a contract"
        behavior: crud
        crud:
          operation: delete
          table: contract_products
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract_product
        invocation_phrases:
          - "remove product from contract"
          - "remove contract product"
          - "delete contract product"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: product
            type: string
            required: true
            maps_to: product_code
        returns:
          type: affected

      list-products:
        description: "List products for a contract"
        behavior: crud
        crud:
          operation: select
          table: contract_products
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract_product
        invocation_phrases:
          - "list contract products"
          - "show products for contract"
          - "what products does contract have"
        args:
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
        returns:
          type: record_set

      # =========================================================================
      # RATE CARDS
      # =========================================================================

      create-rate-card:
        description: "Create a new rate card"
        behavior: crud
        crud:
          operation: insert
          table: rate_cards
          schema: ob-poc
          returning: rate_card_id
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: rate_card
        invocation_phrases:
          - "create rate card"
          - "new rate card"
          - "add pricing schedule"
        args:
          - name: name
            type: string
            required: true
            maps_to: name
          - name: description
            type: string
            required: false
            maps_to: description
          - name: currency
            type: string
            required: false
            maps_to: currency
            default: "USD"
          - name: effective-date
            type: date
            required: false
            maps_to: effective_date
        returns:
          type: uuid
          name: rate_card_id
          capture: true

      list-rate-cards:
        description: "List all rate cards"
        behavior: crud
        crud:
          operation: select
          table: rate_cards
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: rate_card
        invocation_phrases:
          - "list rate cards"
          - "show rate cards"
          - "all pricing schedules"
        args: []
        returns:
          type: record_set

      # =========================================================================
      # CBU SUBSCRIPTIONS (onboarding gate)
      # =========================================================================

      subscribe:
        description: "Subscribe a CBU to a contract+product (onboarding gate)"
        behavior: crud
        crud:
          operation: insert
          table: cbu_subscriptions
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: subscription
        invocation_phrases:
          - "subscribe cbu to product"
          - "onboard cbu to product"
          - "add cbu to contract product"
          - "subscribe to custody"
          - "onboard to fund admin"
        args:
          - name: cbu-id
            type: uuid
            required: true
            maps_to: cbu_id
            lookup:
              table: cbus
              entity_type: cbu
              schema: ob-poc
              search_key: name
              primary_key: cbu_id
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: product
            type: string
            required: true
            maps_to: product_code
        returns:
          type: affected

      unsubscribe:
        description: "Unsubscribe a CBU from a contract+product"
        behavior: crud
        crud:
          operation: delete
          table: cbu_subscriptions
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: cbu
          noun: subscription
        invocation_phrases:
          - "unsubscribe cbu from product"
          - "remove cbu from contract product"
          - "offboard cbu from product"
        args:
          - name: cbu-id
            type: uuid
            required: true
            maps_to: cbu_id
          - name: contract-id
            type: uuid
            required: true
            maps_to: contract_id
          - name: product
            type: string
            required: true
            maps_to: product_code
        returns:
          type: affected

      list-subscriptions:
        description: "List CBU subscriptions, optionally filtered"
        behavior: crud
        crud:
          operation: select
          table: v_cbu_subscriptions
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: subscription
        invocation_phrases:
          - "list subscriptions"
          - "show cbu subscriptions"
          - "what products is cbu subscribed to"
          - "cbu product subscriptions"
        args:
          - name: cbu-id
            type: uuid
            required: false
            maps_to: cbu_id
          - name: client
            type: string
            required: false
            maps_to: client_label
          - name: product
            type: string
            required: false
            maps_to: product_code
        returns:
          type: record_set

      # =========================================================================
      # LOOKUPS
      # =========================================================================

      for-client:
        description: "Get the active contract for a client"
        behavior: crud
        crud:
          operation: select
          table: legal_contracts
          schema: ob-poc
        metadata:
          tier: intent
          source_of_truth: operational
          scope: global
          noun: contract
        invocation_phrases:
          - "contract for client"
          - "allianz contract"
          - "get client contract"
          - "show client agreement"
        args:
          - name: client
            type: string
            required: true
            maps_to: client_label
        returns:
          type: record
