version: '2.0'
domain: investor-role
description: |
  Investor role profile management for beneficial ownership eligibility and economic look-through policy.

  PURPOSE: Controls how shareholders/unitholders are classified for UBO (Ultimate Beneficial Owner)
  determination and economic exposure computation. Critical for distinguishing between "real" investors
  who receive economic benefit vs intermediaries/nominees who hold on behalf of others.

  KEY CONCEPTS:
  - Issuer-scoped: The same holder entity (e.g., BlackRock) can have different roles for different
    issuers/funds. BlackRock might be an END_INVESTOR in Fund A but an INTERMEDIARY_FOF in Fund B.
  - Temporal versioning: Supports point-in-time queries. If an investor is reclassified mid-year
    (e.g., from END_INVESTOR to FoF after restructuring), historical queries return the correct role.
  - UBO eligibility: Determines whether holdings create UBO edges in the ownership graph.
  - Look-through policy: Controls whether economic exposure computation traverses through this holder.

  DOMAIN JARGON:
  - Nominee holding: Custodian/nominee holds shares on behalf of beneficial owners (e.g., State Street
    holding for pension fund clients). Not UBO-eligible - the underlying clients are the real owners.
  - Omnibus account: Single account aggregating multiple underlying investors. Common in fund admin.
  - Fund-of-funds (FoF): Intermediary fund that invests in target funds. Requires look-through to
    find ultimate LPs/investors.
  - Master-feeder: Pooling structure where feeder funds invest in master. Master holds assets,
    feeders are economic pass-through.
  - Intra-group treasury: Corporate group moving cash between subsidiaries. Not "real" external investor.
  - TA holding: Transfer Agent administrative record. Not beneficial ownership.
  - End investor: Terminal holder who actually receives economic benefit. The "proper person" in KYC terms.

  ROLE TYPES:
  - END_INVESTOR: Ultimate beneficial owner candidate, proper person (individual or terminal entity)
  - NOMINEE: Holding on behalf of others (custodian, nominee company, etc.)
  - OMNIBUS: Omnibus account aggregating multiple underlying investors
  - INTERMEDIARY_FOF: Fund-of-funds intermediary investing in other funds
  - MASTER_POOL: Master pooling vehicle in master-feeder structure
  - INTRA_GROUP_POOL: Intra-group pooling (same corporate group, treasury operations)
  - TREASURY: Group treasury function
  - CUSTODIAN: Custodial holding (bank custody, safekeeping)
  - OTHER: Other role type requiring manual classification
verbs:
- verb: investor-role.history
  domain: investor-role
  action: history
  aliases:
  - history
  args:
    style: keyworded
    required:
      holder:
        type: entity_name
      issuer:
        type: entity_name
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - role profile history
  - classification changes
  - audit trail for investor
  - how has classification changed
  - historical role versions
  - history investor-role
  - history the investor-role
  - investor-role history
  examples:
  - (investor-role.history :issuer "..." :holder "...")
  doc: |
    Get all historical versions of a role profile for a holder-issuer relationship.

    Shows the complete audit trail of classification changes over time.
    Ordered by effective_from descending (most recent first).

    Use for regulatory audit trails, investigating classification changes,
    or understanding how holder treatment evolved over time.
  tier: diagnostics
- verb: investor-role.set
  domain: investor-role
  action: set
  aliases:
  - set
  args:
    style: keyworded
    required:
      issuer:
        type: entity_name
      role-type:
        type: str
      holder:
        type: entity_name
    optional:
      notes:
        type: str
      is-ubo-eligible:
        type: bool
      group-container:
        type: entity_name
      group-label:
        type: str
      share-class:
        type: entity_name
      bo-data-available:
        type: bool
      holder-affiliation:
        type: str
      lookthrough-policy:
        type: str
      effective-from:
        type: date
      source:
        type: str
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - set investor role
  - classify holder
  - set holder type
  - configure investor classification
  - set shareholder role
  - classify shareholder
  - set unitholder type
  - configure look-through policy
  - set UBO eligibility
  - mark as nominee
  - mark as FoF
  - mark as end investor
  - set investor-role
  - set the investor-role
  - investor-role set
  examples:
  - (investor-role.set :issuer "..." :holder "..." :role-type "...")
  doc: |
    Set or update the investor role profile for a holder-issuer relationship.
    Creates a new temporal version if effective_from differs from existing record.

    Use this to classify how a shareholder/unitholder should be treated for UBO
    determination and economic look-through. The classification affects:
    1. Whether holdings create UBO edges (is_ubo_eligible)
    2. Whether economic exposure computation traverses through this holder (lookthrough_policy)
    3. How the holder appears in investor register visualization

    EXAMPLES:
    - Classify BlackRock as a fund-of-funds for Fund A
    - Mark State Street as a nominee/custodian
    - Set a pension fund as an end investor (terminal UBO)
    - Configure look-through policy for institutional holders

    TEMPORAL BEHAVIOR: If a profile already exists for this issuer-holder pair,
    and you provide a different effective_from date, the old record gets closed
    (effective_to set) and a new version is created. This preserves history.
  tier: intent
- verb: investor-role.mark-as-nominee
  domain: investor-role
  action: mark-as-nominee
  aliases:
  - mark-as-nominee
  args:
    style: keyworded
    required:
      issuer:
        type: entity_name
      holder:
        type: entity_name
    optional:
      notes:
        type: str
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - mark as nominee
  - classify as nominee
  - set as custodian
  - this is a nominee holding
  - exclude from UBO
  - custodial holding
  - nominee company
  - mark as nominee investor-role
  - mark as nominee the investor-role
  - investor-role mark as nominee
  examples:
  - (investor-role.mark-as-nominee :issuer "..." :holder "...")
  doc: |
    Mark a holder as a nominee (custodian, nominee company, etc.).

    EFFECT: Sets role_type=NOMINEE, is_ubo_eligible=false, lookthrough_policy=NONE

    Use when:
    - Holder is a custodian bank holding on behalf of clients (State Street, BNY Mellon)
    - Holder is a nominee company (e.g., "XYZ Nominees Ltd")
    - Holder is a depositary/trustee holding assets for beneficial owners
    - You want to exclude this holder from UBO graph entirely

    This is the most common classification for custodial holdings. The beneficial
    owners behind the nominee should be identified separately.
  tier: intent
- verb: investor-role.read
  domain: investor-role
  action: read
  aliases:
  - fetch
  - get
  - read
  args:
    style: keyworded
    required:
      holder:
        type: entity_name
      issuer:
        type: entity_name
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - get investor role
  - check holder classification
  - what type of investor
  - how is holder classified
  - get shareholder role
  - check UBO eligibility
  - read investor-role
  - read the investor-role
  - get investor-role
  - fetch investor-role
  - investor-role read
  examples:
  - (investor-role.read :issuer "..." :holder "...")
  doc: |
    Read the current (active) role profile for a holder-issuer relationship.
    Returns the profile where effective_to IS NULL (current version).

    Use this to check how a holder is currently classified for a specific issuer.
    For historical/point-in-time queries, use read-as-of instead.
  tier: diagnostics
- verb: investor-role.list-by-holder
  domain: investor-role
  action: list-by-holder
  aliases:
  - list-by-holder
  args:
    style: keyworded
    required:
      holder:
        type: entity_name
  positional_sugar:
  - holder
  invocation_phrases:
  - list roles for investor
  - how is holder classified everywhere
  - all funds where investor
  - BlackRock classifications
  - investor role across funds
  - list by holder investor-role
  - list by holder the investor-role
  - investor-role list by holder
  examples:
  - (investor-role.list-by-holder :holder "...")
  doc: |
    List all current role profiles for a holder across all issuers.

    Use this to see how a specific investor (e.g., BlackRock) is classified
    across different funds. The same holder may have different roles for
    different issuers - this shows the complete picture.
  tier: diagnostics
- verb: investor-role.mark-as-master-pool
  domain: investor-role
  action: mark-as-master-pool
  aliases:
  - mark-as-master-pool
  args:
    style: keyworded
    required:
      issuer:
        type: entity_name
      holder:
        type: entity_name
    optional:
      holder-affiliation:
        type: str
      notes:
        type: str
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - mark as master fund
  - mark as master pool
  - master-feeder structure
  - this is a master vehicle
  - pooling vehicle
  - mark as master pool investor-role
  - mark as master pool the investor-role
  - investor-role mark as master pool
  examples:
  - (investor-role.mark-as-master-pool :issuer "..." :holder "...")
  doc: |
    Mark a holder as a master pooling vehicle (master fund in master-feeder structure).

    EFFECT: Sets role_type=MASTER_POOL, is_ubo_eligible=false, lookthrough_policy=AUTO_IF_DATA

    Use when:
    - Holder is the master fund in a master-feeder structure
    - Feeder funds invest in the master, master holds the actual assets
    - Economic look-through should auto-traverse if feeder data is available

    Master-feeder structures are common for institutional funds. The master
    is not an end investor - it's a pooling mechanism.
  tier: intent
- verb: investor-role.list-by-issuer
  domain: investor-role
  action: list-by-issuer
  aliases:
  - list-by-issuer
  args:
    style: keyworded
    required:
      issuer:
        type: entity_name
    optional:
      role-type:
        type: str
      is-ubo-eligible:
        type: bool
  positional_sugar:
  - issuer
  invocation_phrases:
  - list investor roles for fund
  - show holder classifications
  - all shareholders roles
  - investor register classifications
  - who are the nominees
  - list end investors
  - show FoF intermediaries
  - list by issuer investor-role
  - list by issuer the investor-role
  - investor-role list by issuer
  examples:
  - (investor-role.list-by-issuer :issuer "...")
  doc: |
    List all current role profiles for an issuer (fund/vehicle).

    Use this to see how all shareholders/unitholders of a fund are classified.
    Helpful for reviewing investor register classifications, identifying
    nominees vs end investors, or auditing UBO eligibility settings.

    Can filter by role_type or is_ubo_eligible to find specific classifications.
  tier: diagnostics
- verb: investor-role.mark-as-end-investor
  domain: investor-role
  action: mark-as-end-investor
  aliases:
  - mark-as-end-investor
  args:
    style: keyworded
    required:
      issuer:
        type: entity_name
      holder:
        type: entity_name
    optional:
      notes:
        type: str
      holder-affiliation:
        type: str
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - mark as end investor
  - terminal investor
  - beneficial owner
  - proper person
  - real investor
  - this is the actual owner
  - no look-through needed
  - mark as end investor investor-role
  - mark as end investor the investor-role
  - investor-role mark as end investor
  examples:
  - (investor-role.mark-as-end-investor :issuer "..." :holder "...")
  doc: |
    Mark a holder as an end investor (terminal beneficial owner).

    EFFECT: Sets role_type=END_INVESTOR, is_ubo_eligible=true, lookthrough_policy=NONE

    Use when:
    - Holder is the ultimate beneficial owner receiving economic benefit
    - Holder is a "proper person" in KYC terms (individual or terminal entity)
    - No further look-through is needed
    - Examples: pension funds investing directly, HNW individuals, sovereign wealth funds

    End investors ARE UBO-eligible and WILL create UBO edges when their
    holdings exceed disclosure thresholds.
  tier: intent
- verb: investor-role.mark-as-fof
  domain: investor-role
  action: mark-as-fof
  aliases:
  - mark-as-fof
  args:
    style: keyworded
    required:
      holder:
        type: entity_name
      issuer:
        type: entity_name
    optional:
      bo-data-available:
        type: bool
      notes:
        type: str
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - mark as fund of funds
  - mark as FoF
  - classify as feeder fund
  - this is a FoF
  - intermediary fund
  - set look-through
  - mark as fof investor-role
  - mark as fof the investor-role
  - investor-role mark as fof
  examples:
  - (investor-role.mark-as-fof :issuer "..." :holder "...")
  doc: |
    Mark a holder as a fund-of-funds intermediary.

    EFFECT: Sets role_type=INTERMEDIARY_FOF, is_ubo_eligible=false, lookthrough_policy=ON_DEMAND

    Use when:
    - Holder is itself a fund that invests in other funds
    - You need to look through to find the ultimate LPs/investors
    - Examples: feeder funds, fund-of-funds, multi-manager platforms

    FoFs are not end investors - they're intermediaries. Economic exposure
    computation can traverse through them to find underlying investors
    when look-through is requested and BO data is available.
  tier: intent
- verb: investor-role.read-as-of
  domain: investor-role
  action: read-as-of
  aliases:
  - read-as-of
  args:
    style: keyworded
    required:
      as-of-date:
        type: date
      issuer:
        type: entity_name
      holder:
        type: entity_name
  positional_sugar:
  - issuer
  - holder
  invocation_phrases:
  - historical investor role
  - investor role as of date
  - holder classification at date
  - point in time role
  - what was holder type on date
  - read as of investor-role
  - read as of the investor-role
  - investor-role read as of
  examples:
  - (investor-role.read-as-of :issuer "..." :holder "..." :as-of-date "...")
  doc: |
    Read the role profile as of a specific historical date (point-in-time query).

    Use this when you need to know how a holder was classified at a specific point
    in time, e.g., for historical UBO reports, audit trails, or regulatory filings
    that require as-of-date accuracy.

    EXAMPLE: If BlackRock was reclassified from END_INVESTOR to INTERMEDIARY_FOF
    on July 1, 2024:
    - read-as-of with date=2024-03-15 returns END_INVESTOR
    - read-as-of with date=2024-09-15 returns INTERMEDIARY_FOF
  tier: diagnostics
