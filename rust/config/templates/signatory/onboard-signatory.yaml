template: onboard-signatory
version: 1

metadata:
  name: Onboard Authorized Signatory
  summary: Add a natural person as authorized signatory with full KYC setup

  description: |
    Creates a new person entity and onboards them as an authorized signatory
    of a CBU. This is similar to director onboarding but with signatory-specific
    document requirements and less intensive screening.

    Authorized signatories can execute transactions on behalf of the CBU
    and must be verified for identity and authorization.

  when_to_use:
    - Adding a new signatory who doesn't exist in the system
    - Workflow blocker shows "missing_role:AUTHORIZED_SIGNATORY"
    - User says "add [name] as signatory" and person not found

  when_not_to_use:
    - Person already exists (use cbu.assign-role directly)
    - Adding as director (use onboard-director)

  effects:
    - New person entity created
    - AUTHORIZED_SIGNATORY role assigned to CBU
    - Entity workstream created in KYC case
    - Document requests sent (ID, signature specimen)
    - Basic screening check queued

  next_steps:
    - Upload/catalog identity documents
    - Obtain signature specimen
    - Review screening results if hits found

tags:
  - signatory
  - person
  - role
  - entity-collection
  - kyc
  - onboarding

workflow_context:
  applicable_workflows:
    - kyc_onboarding
    - cbu_creation
  applicable_states:
    - ENTITY_COLLECTION
    - REMEDIATION
  resolves_blockers:
    - missing_role:AUTHORIZED_SIGNATORY

params:
  cbu_id:
    type: cbu_ref
    required: true
    source: session
    description: Target CBU for the signatory

  case_id:
    type: uuid
    required: true
    source: session
    description: Active KYC case for workstream creation

  name:
    type: string
    required: true
    prompt: "Signatory's full legal name"
    example: "Jane Smith"

  date_of_birth:
    type: date
    required: true
    prompt: "Date of birth"
    example: "1980-06-22"

  nationality:
    type: country_code
    required: true
    prompt: "Nationality (ISO 2-letter code)"
    example: "US"

  signing_authority:
    type: enum
    required: false
    default: "SOLE"
    enum_values:
      - SOLE
      - JOINT
    prompt: "Signing authority type"

  effective_date:
    type: date
    required: false
    default: "today"
    prompt: "Role effective date"

body: |
  (let [person (entity.create-proper-person
                 :name "$name"
                 :date-of-birth "$date_of_birth"
                 :nationality "$nationality")]
    (cbu.assign-role
      :cbu "$cbu_id"
      :entity person
      :role AUTHORIZED_SIGNATORY
      :effective-from "$effective_date")
    (entity-workstream.create
      :case "$case_id"
      :entity person)
    (document.request
      :entity person
      :types [NATIONAL_ID SIGNATURE_SPECIMEN])
    (case-screening.run
      :case "$case_id"
      :entity person
      :types [SANCTIONS]))

outputs:
  person:
    type: entity_ref
    description: Created person entity ID
    binding: person

related_templates:
  - onboard-director
  - catalog-document
