template: add-ownership
version: 1

metadata:
  name: Add Ownership Relationship
  summary: Add an ownership stake in the ownership structure

  description: |
    Records an ownership relationship where one entity owns a percentage
    of another entity. This builds the ownership structure used for
    UBO determination.

    Can be used to add:
    - Direct ownership (person -> company)
    - Indirect ownership (company -> company)

  when_to_use:
    - Building ownership structure for UBO determination
    - Workflow blocker shows "incomplete_ownership"
    - User says "X owns Y% of Z"

  when_not_to_use:
    - Updating existing ownership (use ubo.update-ownership)
    - Ending ownership (use ubo.end-ownership)

  effects:
    - Ownership relationship recorded
    - Ownership total recalculated
    - May trigger UBO recalculation if over threshold

  next_steps:
    - Continue adding ownership relationships
    - Run trace-chains to compute UBO
    - Register identified UBOs

tags:
  - ubo
  - ownership
  - structure

workflow_context:
  applicable_workflows:
    - kyc_onboarding
    - ubo_determination
  applicable_states:
    - UBO_DETERMINATION
    - OWNERSHIP_MAPPING
  resolves_blockers:
    - incomplete_ownership

params:
  owner_id:
    type: entity_ref
    required: true
    prompt: "Owner entity (person or company)"

  owned_id:
    type: entity_ref
    required: true
    prompt: "Owned entity (the company being owned)"

  percentage:
    type: decimal
    required: true
    prompt: "Ownership percentage (0-100)"
    validation: "0 < percentage <= 100"
    example: "25.5"

  ownership_type:
    type: enum
    required: false
    enum_values:
      - DIRECT
      - INDIRECT
      - BENEFICIAL
    default: "DIRECT"

  effective_date:
    type: date
    required: false
    default: "today"
    prompt: "Effective date of ownership"

body: |
  (ubo.add-ownership
    :owner "$owner_id"
    :owned "$owned_id"
    :percentage $percentage
    :type $ownership_type
    :effective-from "$effective_date")

outputs:
  ownership_id:
    type: uuid
    description: Created ownership relationship ID

related_templates:
  - trace-chains
  - register-ubo
  - add-corporate-owner
