template: register-ubo
version: 1

metadata:
  name: Register UBO
  summary: Register a person as Ultimate Beneficial Owner of a CBU

  description: |
    Formally registers a natural person as a UBO of a CBU after
    ownership determination. This creates the official UBO record
    with qualifying reason and ownership percentage.

    The UBO must then be verified through KYC processes including
    identity verification, screening, and source of wealth checks.

  when_to_use:
    - After trace-chains identifies potential UBO
    - Workflow blocker shows "ubo_not_registered"
    - User confirms person is a UBO

  when_not_to_use:
    - Person is not a natural person
    - Ownership below threshold (use add-ownership to track)

  effects:
    - UBO record created
    - Entity workstream created for UBO verification
    - Enhanced due diligence may be triggered

  next_steps:
    - Verify UBO identity
    - Run enhanced screening
    - Obtain source of wealth documentation

tags:
  - ubo
  - registration
  - kyc

workflow_context:
  applicable_workflows:
    - kyc_onboarding
    - ubo_determination
  applicable_states:
    - UBO_DETERMINATION
    - UBO_VERIFICATION
  resolves_blockers:
    - ubo_not_registered

params:
  cbu_id:
    type: cbu_ref
    required: true
    source: session
    description: CBU for UBO registration

  case_id:
    type: uuid
    required: true
    source: session
    description: Active KYC case

  subject_entity_id:
    type: entity_ref
    required: true
    prompt: "Entity being owned (usually the main company)"

  ubo_person_id:
    type: entity_ref
    required: true
    prompt: "Natural person who is the UBO"

  ownership_percentage:
    type: decimal
    required: true
    prompt: "Calculated ownership percentage"
    example: "35.5"

  qualifying_reason:
    type: enum
    required: true
    enum_values:
      - OWNERSHIP_25PCT
      - CONTROL_VOTING
      - CONTROL_BOARD
      - SENIOR_MANAGEMENT
    prompt: "Reason this person qualifies as UBO"

body: |
  (ubo.register-ubo
    :cbu "$cbu_id"
    :subject-entity "$subject_entity_id"
    :ubo-person "$ubo_person_id"
    :ownership-percentage $ownership_percentage
    :qualifying-reason $qualifying_reason)
  (entity-workstream.create
    :case "$case_id"
    :entity "$ubo_person_id"
    :discovery-reason "UBO_DETERMINATION"
    :is-ubo true)

outputs:
  ubo_id:
    type: uuid
    description: Created UBO registration ID

related_templates:
  - verify-ubo
  - add-ownership
  - trace-chains
