<!DOCTYPE html>
<html>
<head>
    <title>DSL Agent</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; margin: 0; padding: 0; background: #f0f2f5; height: 100vh; display: flex; flex-direction: column; }
        .header { background: #1a1a2e; color: white; padding: 0.75rem 1.5rem; display: flex; align-items: center; justify-content: space-between; flex-shrink: 0; }
        .header h1 { margin: 0; font-size: 1.25rem; font-weight: 600; }
        .header-status { font-size: 0.8rem; }
        .header-status.connected { color: #90EE90; }
        .header-status.disconnected { color: #ff6b6b; }
        .main { display: flex; flex: 1; overflow: hidden; }
        .chat-panel { flex: 1; display: flex; flex-direction: column; border-right: 1px solid #ddd; background: white; }
        .dsl-panel { width: 500px; display: flex; flex-direction: column; background: #fafafa; }
        .panel-header { padding: 0.75rem 1rem; background: #e9ecef; border-bottom: 1px solid #ddd; font-weight: 600; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 1rem; }
        .chat-input { padding: 1rem; border-top: 1px solid #ddd; background: #fafafa; }
        .chat-input-row { display: flex; gap: 0.5rem; }
        .chat-input input { flex: 1; padding: 0.75rem; border: 1px solid #ddd; border-radius: 6px; font-size: 0.95rem; }
        .chat-input input:focus { outline: none; border-color: #007bff; }
        .chat-input button { padding: 0.75rem 1.5rem; }
        .msg { margin-bottom: 1rem; }
        .msg-user { text-align: right; }
        .msg-user .msg-bubble { background: #007bff; color: white; display: inline-block; padding: 0.75rem 1rem; border-radius: 12px 12px 0 12px; max-width: 80%; text-align: left; }
        .msg-assistant .msg-bubble { background: #e9ecef; display: inline-block; padding: 0.75rem 1rem; border-radius: 12px 12px 12px 0; max-width: 80%; }
        .msg-dsl { background: #282c34; color: #abb2bf; padding: 0.75rem; border-radius: 6px; margin-top: 0.5rem; font-family: "SF Mono", Monaco, monospace; font-size: 0.8rem; white-space: pre-wrap; overflow-x: auto; }
        .dsl-content { flex: 1; overflow-y: auto; padding: 1rem; }
        .dsl-code { background: #282c34; color: #abb2bf; padding: 1rem; border-radius: 6px; font-family: "SF Mono", Monaco, monospace; font-size: 0.85rem; white-space: pre-wrap; min-height: 200px; }
        .dsl-actions { padding: 1rem; border-top: 1px solid #ddd; background: #e9ecef; }
        .dsl-actions button { margin-right: 0.5rem; }
        .results { padding: 1rem; border-top: 1px solid #ddd; overflow-y: auto; max-height: 300px; }
        .result-box { padding: 0.75rem; border-radius: 6px; margin-bottom: 0.5rem; border-left: 4px solid #ddd; background: white; }
        .result-box.success { border-color: #28a745; }
        .result-box.error { border-color: #dc3545; }
        .result-header { font-weight: 600; font-size: 0.9rem; }
        .result-detail { font-size: 0.8rem; color: #666; margin-top: 0.25rem; }
        .bindings { margin-top: 0.5rem; }
        .binding { display: inline-block; background: #e9ecef; padding: 0.2rem 0.4rem; border-radius: 3px; margin: 0.2rem; font-family: monospace; font-size: 0.75rem; }
        button { background: #007bff; color: white; border: none; padding: 0.5rem 1rem; border-radius: 4px; cursor: pointer; font-weight: 500; }
        button:hover { background: #0056b3; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        button.success { background: #28a745; }
        button.success:hover { background: #1e7e34; }
        button.secondary { background: #6c757d; }
        button.danger { background: #dc3545; }
        .spinner { display: inline-block; width: 14px; height: 14px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 0.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .settings-btn { background: transparent; color: rgba(255,255,255,0.7); padding: 0.25rem 0.5rem; font-size: 0.8rem; }
        .settings-btn:hover { color: white; background: rgba(255,255,255,0.1); }
        .empty-state { text-align: center; color: #999; padding: 3rem; }
        .empty-state p { margin: 0.5rem 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>DSL Agent</h1>
        <div style="display: flex; align-items: center; gap: 1rem;">
            <span id="header-status" class="header-status {{if .Connected}}connected{{else}}disconnected{{end}}">
                {{if .Connected}}Connected{{else}}Disconnected{{end}}
            </span>
            <button class="settings-btn" id="settings-btn">Settings</button>
        </div>
    </div>

    <div class="main">
        <div class="chat-panel">
            <div class="panel-header">
                <span>Chat</span>
                <button class="secondary" id="new-session-btn" style="padding: 0.25rem 0.75rem; font-size: 0.8rem;">New Session</button>
            </div>
            <div id="chat-messages" class="chat-messages">
                <div class="empty-state">
                    <p><strong>Describe what you want to create</strong></p>
                    <p>e.g., "Create a fund in Luxembourg with John Smith as director"</p>
                </div>
            </div>
            <div class="chat-input">
                <div class="chat-input-row">
                    <input type="text" id="chat-input" placeholder="Describe what you want to create...">
                    <button class="success" id="send-btn">Send</button>
                </div>
            </div>
        </div>

        <div class="dsl-panel">
            <div class="panel-header">
                <span>Generated DSL</span>
                <span id="dsl-status" style="font-weight: normal; font-size: 0.8rem; color: #666;"></span>
            </div>
            <div class="dsl-content">
                <div id="dsl-code" class="dsl-code">; DSL will appear here after generation</div>
            </div>
            <div class="dsl-actions">
                <button class="success" id="execute-btn" disabled>Execute</button>
                <button class="secondary" id="copy-btn">Copy</button>
                <button class="secondary" id="validate-btn">Validate</button>
            </div>
            <div id="results" class="results" style="display: none;"></div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 100;">
        <div style="background: white; width: 400px; margin: 100px auto; border-radius: 8px; padding: 1.5rem;">
            <h3 style="margin-top: 0;">Settings</h3>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.9rem;">DSL API URL</label>
                <input type="text" id="rust-url" value="{{.RustURL}}" placeholder="http://localhost:3001" style="width: 100%; padding: 0.5rem;">
            </div>
            <div style="margin-bottom: 1rem;">
                <label style="display: block; margin-bottom: 0.25rem; font-size: 0.9rem;">Agent API URL</label>
                <input type="text" id="agent-url" value="http://localhost:3000" placeholder="http://localhost:3000" style="width: 100%; padding: 0.5rem;">
            </div>
            <div style="display: flex; gap: 0.5rem; justify-content: flex-end;">
                <button class="secondary" id="settings-cancel">Cancel</button>
                <button id="settings-save">Save</button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
