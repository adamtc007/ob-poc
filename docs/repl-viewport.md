# REPL & Viewport Interaction (ASCII)

> How the REPL interface and egui viewport interact
> Reference doc for Claude Code when working on UI state management

---

## 1. System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      REPL & VIEWPORT SYSTEM                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Two Interfaces, One State:                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚   â”‚      REPL (CLI)         â”‚         â”‚   VIEWPORT (egui/web)   â”‚           â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚
â”‚   â”‚  Text-based interface   â”‚         â”‚  Graphical interface    â”‚           â”‚
â”‚   â”‚  DSL input/output       â”‚â—€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  Entity graph viz       â”‚           â”‚
â”‚   â”‚  Agent chat             â”‚  SHARED â”‚  5-panel layout         â”‚           â”‚
â”‚   â”‚  Script execution       â”‚  STATE  â”‚  Voice integration      â”‚           â”‚
â”‚   â”‚  Quick commands         â”‚         â”‚  Interactive drill-down â”‚           â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚              â”‚                                   â”‚                          â”‚
â”‚              â”‚                                   â”‚                          â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                            â”‚                                                 â”‚
â”‚                            â–¼                                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚      SHARED SESSION STATE   â”‚                                â”‚
â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                â”‚
â”‚              â”‚  - Current CBU context      â”‚                                â”‚
â”‚              â”‚  - Capture map (@variables) â”‚                                â”‚
â”‚              â”‚  - Navigation history       â”‚                                â”‚
â”‚              â”‚  - Selected entities        â”‚                                â”‚
â”‚              â”‚  - View state               â”‚                                â”‚
â”‚              â”‚  - Agent conversation       â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                            â”‚                                                 â”‚
â”‚                            â–¼                                                 â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚              â”‚       PostgreSQL            â”‚                                â”‚
â”‚              â”‚     (data_designer)         â”‚                                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. Viewport 5-Panel Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VIEWPORT 5-PANEL LAYOUT                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                           TOOLBAR                                    â”‚   â”‚
â”‚   â”‚  [CBU Selector â–¼] [View Mode â–¼] [Search...] [Voice ğŸ¤] [Settings âš™] â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚               â”‚                                  â”‚                   â”‚   â”‚
â”‚   â”‚    CONTEXT    â”‚            GRAPH                 â”‚      RESULTS     â”‚   â”‚
â”‚   â”‚    PANEL      â”‚            PANEL                 â”‚      PANEL       â”‚   â”‚
â”‚   â”‚               â”‚                                  â”‚                   â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ CBU Info  â”‚ â”‚   â”‚                         â”‚   â”‚ â”‚ Execution Log â”‚ â”‚   â”‚
â”‚   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚      Entity Graph       â”‚   â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚   â”‚
â”‚   â”‚ â”‚ Products  â”‚ â”‚   â”‚                         â”‚   â”‚ â”‚ Last Result   â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Services  â”‚ â”‚   â”‚    â”Œâ”€â”€â”€â”    â”Œâ”€â”€â”€â”      â”‚   â”‚ â”‚ Errors        â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Roles     â”‚ â”‚   â”‚    â”‚ A â”‚â”€â”€â”€â”€â”‚ B â”‚      â”‚   â”‚ â”‚ Captures      â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Documents â”‚ â”‚   â”‚    â””â”€â”€â”€â”˜    â””â”€â”¬â”€â”˜      â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â”‚           â”‚ â”‚   â”‚              â”‚         â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚   â”‚         â”Œâ”€â”€â”€â”â”‚         â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Taxonomy  â”‚ â”‚   â”‚         â”‚ C â”‚â—€â”˜         â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Navigator â”‚ â”‚   â”‚         â””â”€â”€â”€â”˜          â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â”‚           â”‚ â”‚   â”‚                         â”‚   â”‚ â”‚               â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚               â”‚                                  â”‚                   â”‚   â”‚
â”‚   â”‚   200px       â”‚         flex                     â”‚      250px        â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                               â”‚                                      â”‚   â”‚
â”‚   â”‚         CHAT PANEL            â”‚           DSL PANEL                  â”‚   â”‚
â”‚   â”‚                               â”‚                                      â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ Agent: How can I help?    â”‚ â”‚ â”‚ ;; DSL Editor                   â”‚ â”‚   â”‚
â”‚   â”‚ â”‚                           â”‚ â”‚ â”‚                                 â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ You: Add John as director â”‚ â”‚ â”‚ (cbu.ensure                     â”‚ â”‚   â”‚
â”‚   â”‚ â”‚                           â”‚ â”‚ â”‚   :name "Acme Fund"             â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Agent: Generated:         â”‚ â”‚ â”‚   :jurisdiction "LU"           â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ (cbu.assign-role ...)     â”‚ â”‚ â”‚   :as @fund)                   â”‚ â”‚   â”‚
â”‚   â”‚ â”‚                           â”‚ â”‚ â”‚                                 â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ Execute? [Y/n]            â”‚ â”‚ â”‚ [Run] [Clear] [Load] [Save]    â”‚ â”‚   â”‚
â”‚   â”‚ â”‚                           â”‚ â”‚ â”‚                                 â”‚ â”‚   â”‚
â”‚   â”‚ â”‚ [____________________] â–¶  â”‚ â”‚ â”‚                                 â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                               â”‚                                      â”‚   â”‚
â”‚   â”‚           50%                 â”‚              50%                     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Panel Heights: Top row = 60%, Bottom row = 40%                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Shared Session State

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SHARED SESSION STATE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   rust/crates/ob-poc-ui/src/session.rs                                      â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ pub struct SharedSession {                                           â”‚   â”‚
â”‚   â”‚     // Identity                                                      â”‚   â”‚
â”‚   â”‚     pub session_id: Uuid,                                           â”‚   â”‚
â”‚   â”‚     pub created_at: DateTime<Utc>,                                  â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚     // Context                                                       â”‚   â”‚
â”‚   â”‚     pub current_cbu: Option<CbuContext>,   // Active CBU            â”‚   â”‚
â”‚   â”‚     pub capture_map: HashMap<String, Value>, // @captured vars      â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚     // Navigation                                                    â”‚   â”‚
â”‚   â”‚     pub nav_history: Vec<NavigationState>,  // Back/forward         â”‚   â”‚
â”‚   â”‚     pub selected_entities: HashSet<Uuid>,   // Multi-select         â”‚   â”‚
â”‚   â”‚     pub focused_entity: Option<Uuid>,       // Single focus         â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚     // View State                                                    â”‚   â”‚
â”‚   â”‚     pub graph_viewport: GraphViewport,      // Pan, zoom, layout    â”‚   â”‚
â”‚   â”‚     pub taxonomy_path: Vec<TaxonomyNode>,   // Drill-down path      â”‚   â”‚
â”‚   â”‚     pub active_panel: Panel,                // Which panel focused  â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚     // Agent                                                         â”‚   â”‚
â”‚   â”‚     pub agent_history: Vec<AgentMessage>,   // Conversation         â”‚   â”‚
â”‚   â”‚     pub pending_dsl: Option<String>,        // Awaiting confirm     â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚     // Results                                                       â”‚   â”‚
â”‚   â”‚     pub last_result: Option<ExecutionResult>,                       â”‚   â”‚
â”‚   â”‚     pub error_log: Vec<ErrorEntry>,                                 â”‚   â”‚
â”‚   â”‚ }                                                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   State Sharing:                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        Arc<RwLock<SharedSession>>        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚    REPL    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  VIEWPORT  â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                          â”‚   State Changes     â”‚                            â”‚
â”‚                          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚
â”‚                          â”‚ - CBU switch        â”‚                            â”‚
â”‚                          â”‚ - Entity select     â”‚                            â”‚
â”‚                          â”‚ - Capture update    â”‚                            â”‚
â”‚                          â”‚ - Nav history push  â”‚                            â”‚
â”‚                          â”‚ - DSL execution     â”‚                            â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                     â”‚                                        â”‚
â”‚                                     â–¼                                        â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                          â”‚  Both UIs update    â”‚                            â”‚
â”‚                          â”‚  automatically      â”‚                            â”‚
â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. REPL Commands

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          REPL COMMANDS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   rust/src/repl/mod.rs                                                       â”‚
â”‚                                                                              â”‚
â”‚   Navigation Commands:                                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚   :cbu <name>         Switch CBU context                                    â”‚
â”‚   :cbu                Show current CBU                                      â”‚
â”‚   :ls                 List entities in current CBU                          â”‚
â”‚   :select <id>        Select entity (updates viewport)                      â”‚
â”‚   :focus <id>         Focus entity in graph                                 â”‚
â”‚   :back               Navigate back                                         â”‚
â”‚   :forward            Navigate forward                                      â”‚
â”‚                                                                              â”‚
â”‚   DSL Commands:                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚   (dsl.verb :arg val) Execute DSL directly                                  â”‚
â”‚   :run <file>         Run DSL script file                                   â”‚
â”‚   :load <file>        Load DSL into editor                                  â”‚
â”‚   :save <file>        Save DSL editor content                               â”‚
â”‚   :history            Show execution history                                â”‚
â”‚   :captures           Show captured variables                               â”‚
â”‚                                                                              â”‚
â”‚   Agent Commands:                                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚   /ask <query>        Natural language query                                â”‚
â”‚   /research <query>   Research macro                                        â”‚
â”‚   /confirm            Confirm pending DSL                                   â”‚
â”‚   /cancel             Cancel pending DSL                                    â”‚
â”‚   /edit               Edit pending DSL                                      â”‚
â”‚                                                                              â”‚
â”‚   View Commands:                                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                             â”‚
â”‚   :graph              Focus graph panel                                     â”‚
â”‚   :chat               Focus chat panel                                      â”‚
â”‚   :dsl                Focus DSL panel                                       â”‚
â”‚   :zoom <level>       Set graph zoom                                        â”‚
â”‚   :layout <type>      Change graph layout (force, tree, radial)             â”‚
â”‚                                                                              â”‚
â”‚   System Commands:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚   :help               Show help                                             â”‚
â”‚   :clear              Clear results panel                                   â”‚
â”‚   :reset              Reset session state                                   â”‚
â”‚   :quit               Exit REPL                                             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. State Synchronization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STATE SYNCHRONIZATION FLOW                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Example: User executes DSL in REPL, viewport updates automatically        â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  REPL Input:                                                          â”‚  â”‚
â”‚   â”‚  > (cbu.ensure :name "Acme" :jurisdiction "LU" :as @fund)            â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  1. DSL EXECUTION                                                     â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚  â”‚
â”‚   â”‚  Parser â†’ Compiler â†’ Executor â†’ PostgreSQL                           â”‚  â”‚
â”‚   â”‚  Returns: { cbu_id: "550e8400-...", name: "Acme" }                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  2. STATE UPDATE                                                      â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚  â”‚
â”‚   â”‚  session.write() {                                                    â”‚  â”‚
â”‚   â”‚      capture_map.insert("@fund", "550e8400-...");                    â”‚  â”‚
â”‚   â”‚      current_cbu = Some(CbuContext { id: "550e8400-...", ... });     â”‚  â”‚
â”‚   â”‚      last_result = Some(result);                                      â”‚  â”‚
â”‚   â”‚  }                                                                    â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚        â”‚                                                                     â”‚
â”‚        â”‚ State change notification                                          â”‚
â”‚        â–¼                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  3. VIEWPORT REACTS                                                   â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Context Panel:                                                       â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚  â”‚
â”‚   â”‚  â”‚ CBU: Acme       â”‚ â—€â”€â”€ Updated from current_cbu                    â”‚  â”‚
â”‚   â”‚  â”‚ ID: 550e8400... â”‚                                                  â”‚  â”‚
â”‚   â”‚  â”‚ Jurisdiction: LUâ”‚                                                  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Graph Panel:                                                         â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚  â”‚
â”‚   â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”      â”‚ â—€â”€â”€ New node added, auto-focused                â”‚  â”‚
â”‚   â”‚  â”‚    â”‚Acme â”‚      â”‚                                                  â”‚  â”‚
â”‚   â”‚  â”‚    â””â”€â”€â”€â”€â”€â”˜      â”‚                                                  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â”‚  Results Panel:                                                       â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚  â”‚
â”‚   â”‚  â”‚ âœ“ Created Acme  â”‚ â—€â”€â”€ Updated from last_result                    â”‚  â”‚
â”‚   â”‚  â”‚ @fund captured  â”‚ â—€â”€â”€ Shows new capture                           â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚  â”‚
â”‚   â”‚                                                                       â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Graph Interaction Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      GRAPH INTERACTION MODEL                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Entity Graph (rust/crates/ob-poc-ui/src/graph/)                           â”‚
â”‚                                                                              â”‚
â”‚   Node Types:                                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚      CBU      â”‚  â”‚    ENTITY     â”‚  â”‚   EXTERNAL    â”‚                   â”‚
â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
â”‚   â”‚ Fund/Company  â”‚  â”‚ Person/Corp   â”‚  â”‚ Counterparty  â”‚                   â”‚
â”‚   â”‚ (blue)        â”‚  â”‚ (green)       â”‚  â”‚ (orange)      â”‚                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                              â”‚
â”‚   Edge Types:                                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  Ownership (solid, shows %)                                  â”‚
â”‚   - - - - - -   Role (dashed, shows role type)                              â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•  ISDA/CSA (double, shows agreement)                          â”‚
â”‚   Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·  Reference (dotted, informational)                           â”‚
â”‚                                                                              â”‚
â”‚   Interactions:                                                              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                              â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  CLICK (node)      â†’ Select entity                                   â”‚   â”‚
â”‚   â”‚                      Updates: selected_entities, context panel       â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  DOUBLE-CLICK      â†’ Focus/drill-down                                â”‚   â”‚
â”‚   â”‚                      Updates: focused_entity, graph viewport         â”‚   â”‚
â”‚   â”‚                      Loads: Related entities, expands subgraph       â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  RIGHT-CLICK       â†’ Context menu                                    â”‚   â”‚
â”‚   â”‚                      Options: Add role, Create relationship,         â”‚   â”‚
â”‚   â”‚                               View details, Run KYC, etc.            â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  DRAG (node)       â†’ Reposition node                                 â”‚   â”‚
â”‚   â”‚                      Layout: Manual override for force-directed      â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  DRAG (canvas)     â†’ Pan viewport                                    â”‚   â”‚
â”‚   â”‚                      Updates: graph_viewport.offset                  â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  SCROLL            â†’ Zoom in/out                                     â”‚   â”‚
â”‚   â”‚                      Updates: graph_viewport.zoom                    â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  SHIFT+CLICK       â†’ Multi-select                                    â”‚   â”‚
â”‚   â”‚                      Adds to: selected_entities                      â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  ESC               â†’ Deselect all                                    â”‚   â”‚
â”‚   â”‚                      Clears: selected_entities, focused_entity       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Graph â†’ REPL Sync:                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚   When user clicks node in graph:                                           â”‚
â”‚     1. selected_entities updated                                            â”‚
â”‚     2. REPL prompt shows: > [Acme Fund] _                                   â”‚
â”‚     3. Context available for DSL: :cbu-id @selected                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. Taxonomy Navigator

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       TAXONOMY NAVIGATOR                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   Fractal drill-down through entity taxonomy                                â”‚
â”‚   rust/src/taxonomy/                                                         â”‚
â”‚                                                                              â”‚
â”‚   Structure:                                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                 â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  ROOT                                                                â”‚   â”‚
â”‚   â”‚  â””â”€â”€ BY_TYPE                                                         â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Legal Entities                                              â”‚   â”‚
â”‚   â”‚      â”‚   â”œâ”€â”€ Funds                                                   â”‚   â”‚
â”‚   â”‚      â”‚   â”‚   â”œâ”€â”€ UCITS                                               â”‚   â”‚
â”‚   â”‚      â”‚   â”‚   â”œâ”€â”€ AIF                                                 â”‚   â”‚
â”‚   â”‚      â”‚   â”‚   â””â”€â”€ Private Equity                                      â”‚   â”‚
â”‚   â”‚      â”‚   â”œâ”€â”€ Companies                                               â”‚   â”‚
â”‚   â”‚      â”‚   â”‚   â”œâ”€â”€ Operating                                           â”‚   â”‚
â”‚   â”‚      â”‚   â”‚   â””â”€â”€ Holding                                             â”‚   â”‚
â”‚   â”‚      â”‚   â””â”€â”€ Trusts                                                  â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Natural Persons                                             â”‚   â”‚
â”‚   â”‚      â”‚   â”œâ”€â”€ Directors                                               â”‚   â”‚
â”‚   â”‚      â”‚   â”œâ”€â”€ UBOs                                                    â”‚   â”‚
â”‚   â”‚      â”‚   â””â”€â”€ Signatories                                             â”‚   â”‚
â”‚   â”‚      â””â”€â”€ External Parties                                            â”‚   â”‚
â”‚   â”‚          â”œâ”€â”€ Counterparties                                          â”‚   â”‚
â”‚   â”‚          â””â”€â”€ Service Providers                                       â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  â””â”€â”€ BY_JURISDICTION                                                 â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Luxembourg                                                  â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Ireland                                                     â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Cayman Islands                                              â”‚   â”‚
â”‚   â”‚      â””â”€â”€ ...                                                         â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  â””â”€â”€ BY_STATUS                                                       â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Active                                                      â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Pending KYC                                                 â”‚   â”‚
â”‚   â”‚      â”œâ”€â”€ Blocked                                                     â”‚   â”‚
â”‚   â”‚      â””â”€â”€ Offboarded                                                  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   UI Representation:                                                         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                         â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚   â”‚ â—€ Legal Entities > Funds > UCITS        â”‚  â† Breadcrumb                 â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚ [â–  Acme UCITS Fund        ]  (12 UBOs)  â”‚  â† Click to focus            â”‚
â”‚   â”‚ [â–  Beta Growth Fund       ]  (8 UBOs)   â”‚                               â”‚
â”‚   â”‚ [â–  Gamma Income Fund      ]  (5 UBOs)   â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚                               â”‚
â”‚   â”‚ Total: 3 funds, 25 UBOs                 â”‚                               â”‚
â”‚   â”‚                                         â”‚                               â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                              â”‚
â”‚   Drill-Down Flow:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚   Click "Acme UCITS Fund"                                                   â”‚
â”‚     â†’ Graph zooms to show Acme + all related entities                       â”‚
â”‚     â†’ Context panel shows Acme details                                      â”‚
â”‚     â†’ Taxonomy shows: Acme > UBOs > [list of UBOs]                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Galaxy Navigation (Astro Metaphor)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   GALAXY NAVIGATION (ASTRO METAPHOR)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   rust/src/navigation/galaxy.rs                                              â”‚
â”‚                                                                              â”‚
â”‚   Concept: Entity graph as star system                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   GALAXY VIEW (zoomed out)                                          â”‚   â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚              Â·  Â·        Â·                                          â”‚   â”‚
â”‚   â”‚        Â·           â˜…              Â·                                 â”‚   â”‚
â”‚   â”‚     Â·        Â·          Â·    Â·         Â·                            â”‚   â”‚
â”‚   â”‚          â˜… Acme              Â·    â˜…                                 â”‚   â”‚
â”‚   â”‚      Â·           Â·       â˜…         Â·                                â”‚   â”‚
â”‚   â”‚            Â·         Â·        Â·                                      â”‚   â”‚
â”‚   â”‚        Â·       Â·                    Â·                                â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â˜… = CBU (star/sun)                                                â”‚   â”‚
â”‚   â”‚   Â· = Entity (planet/satellite)                                     â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                                  â”‚
â”‚                           â”‚ Zoom into Acme                                  â”‚
â”‚                           â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   SYSTEM VIEW (zoomed in)                                           â”‚   â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚                    â— John (UBO 40%)                                  â”‚   â”‚
â”‚   â”‚                   /                                                  â”‚   â”‚
â”‚   â”‚            â”Œâ”€â”€â”€â”€â”€â”                                                   â”‚   â”‚
â”‚   â”‚      â—â”€â”€â”€â”€â”€â”‚Acme â”‚â”€â”€â”€â”€â”€â—  Jane (Director)                           â”‚   â”‚
â”‚   â”‚   ManCo   â”‚Fund â”‚                                                   â”‚   â”‚
â”‚   â”‚            â””â”€â”€â”€â”€â”€â”˜                                                   â”‚   â”‚
â”‚   â”‚                   \                                                  â”‚   â”‚
â”‚   â”‚                    â— Goldman (Counterparty)                         â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   Acme Fund = Sun (central)                                         â”‚   â”‚
â”‚   â”‚   Related entities = Planets orbiting                               â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                                  â”‚
â”‚                           â”‚ Zoom into John                                  â”‚
â”‚                           â–¼                                                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   ENTITY VIEW (detail)                                              â”‚   â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚   â”‚   â”‚ John Smith                                          â”‚           â”‚   â”‚
â”‚   â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ Type: Natural Person                                â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ Nationality: GB                                     â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ DOB: 1975-03-15                                     â”‚           â”‚   â”‚
â”‚   â”‚   â”‚                                                     â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ Roles:                                              â”‚           â”‚   â”‚
â”‚   â”‚   â”‚   - Acme Fund: UBO (40%)                           â”‚           â”‚   â”‚
â”‚   â”‚   â”‚   - Beta Fund: Director                             â”‚           â”‚   â”‚
â”‚   â”‚   â”‚                                                     â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ KYC Status: Approved (expires 2025-06-01)          â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ Risk Rating: Medium                                 â”‚           â”‚   â”‚
â”‚   â”‚   â”‚                                                     â”‚           â”‚   â”‚
â”‚   â”‚   â”‚ [View Documents] [Run Screening] [Edit]            â”‚           â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Navigation Commands (Voice or REPL):                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚   "Show galaxy"         â†’ Zoom out to all CBUs                              â”‚
â”‚   "Zoom into Acme"      â†’ Focus on Acme system                              â”‚
â”‚   "Enhance John"        â†’ Detail view of John                               â”‚
â”‚   "Track ownership"     â†’ Highlight ownership edges                         â”‚
â”‚   "Show UBO chain"      â†’ Trace UBO relationships                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. View State Persistence

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      VIEW STATE PERSISTENCE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   View state survives page refresh, stored in:                              â”‚
â”‚   - LocalStorage (web)                                                       â”‚
â”‚   - SQLite (desktop)                                                         â”‚
â”‚   - PostgreSQL view_state_audit (server-side history)                       â”‚
â”‚                                                                              â”‚
â”‚   Persisted State:                                                           â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ {                                                                    â”‚   â”‚
â”‚   â”‚   "session_id": "...",                                              â”‚   â”‚
â”‚   â”‚   "current_cbu": "550e8400-...",                                    â”‚   â”‚
â”‚   â”‚   "graph_viewport": {                                               â”‚   â”‚
â”‚   â”‚     "center_x": 500,                                                â”‚   â”‚
â”‚   â”‚     "center_y": 300,                                                â”‚   â”‚
â”‚   â”‚     "zoom": 1.5,                                                    â”‚   â”‚
â”‚   â”‚     "layout": "force"                                               â”‚   â”‚
â”‚   â”‚   },                                                                â”‚   â”‚
â”‚   â”‚   "taxonomy_path": ["Legal Entities", "Funds", "UCITS"],           â”‚   â”‚
â”‚   â”‚   "selected_entities": ["661e8400-...", "772e8400-..."],           â”‚   â”‚
â”‚   â”‚   "panel_sizes": {                                                  â”‚   â”‚
â”‚   â”‚     "context": 200,                                                 â”‚   â”‚
â”‚   â”‚     "results": 250,                                                 â”‚   â”‚
â”‚   â”‚     "bottom_split": 0.5                                             â”‚   â”‚
â”‚   â”‚   },                                                                â”‚   â”‚
â”‚   â”‚   "captures": {                                                     â”‚   â”‚
â”‚   â”‚     "@fund": "550e8400-...",                                       â”‚   â”‚
â”‚   â”‚     "@john": "661e8400-..."                                        â”‚   â”‚
â”‚   â”‚   }                                                                 â”‚   â”‚
â”‚   â”‚ }                                                                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚   Audit Trail (PostgreSQL):                                                  â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚   Every significant state change logged:                                    â”‚
â”‚   - CBU context switch                                                       â”‚
â”‚   - Entity selection                                                         â”‚
â”‚   - DSL execution                                                            â”‚
â”‚   - Navigation events                                                        â”‚
â”‚                                                                              â”‚
â”‚   Enables: "What was I looking at yesterday?"                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. Investor Register Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    INVESTOR REGISTER VISUALIZATION                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   DUAL-MODE DISPLAY                                                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚   Control View (Graph)                 Economic View (Panel)                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚   Individual nodes for:                Aggregate node expands to:            â”‚
â”‚   â€¢ >5% voting/economic                â€¢ Breakdown by type/status           â”‚
â”‚   â€¢ Board rights                       â€¢ Paginated searchable table         â”‚
â”‚   â€¢ Veto rights                        â€¢ Filter & export                    â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚ AllianzGI 35%  â”‚                   â”‚ ğŸ“Š 4,847 other investors (22%) â”‚  â”‚
â”‚   â”‚ âš¡ INSTITUTION â”‚                   â”‚    [Click to expand]            â”‚  â”‚
â”‚   â”‚ [View UBOs]    â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                         â”‚
â”‚                                                                              â”‚
â”‚   TIER-BASED COLORING                                                        â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚   Control (>50%)        â†’ Red                                               â”‚
â”‚   Significant (>25%)    â†’ Yellow                                            â”‚
â”‚   Disclosure (>5%)      â†’ Blue                                              â”‚
â”‚   Special Rights        â†’ Purple                                            â”‚
â”‚                                                                              â”‚
â”‚   INSTITUTIONAL LOOK-THROUGH                                                 â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚   is_terminal           â†’ true = proper person (end of chain)               â”‚
â”‚   has_ubo_structure     â†’ Institution has navigable ownership               â”‚
â”‚   known_ubos            â†’ Pre-fetched UBO summary (max 5)                   â”‚
â”‚   [ğŸ” View UBO Chain]   â†’ Navigates to institution's CBU graph              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Files

| File | Purpose |
|------|---------|
| `rust/src/graph/investor_register.rs` | Server response types |
| `rust/src/api/capital_routes.rs` | API endpoints |
| `rust/crates/ob-poc-types/src/investor_register.rs` | Client types |
| `rust/crates/ob-poc-ui/src/panels/investor_register.rs` | Panel component |
| `rust/crates/ob-poc-ui/src/state.rs` | UI state management |
| `rust/crates/ob-poc-ui/src/app.rs` | Action handling and wiring |

### Design Highlights

1. **Server-side threshold partitioning** - Control holders (>5% or special rights) vs aggregate
2. **Decimal handling** - `rust_decimal::Decimal` server-side, `f64` client-side for JSON
3. **Tier-based coloring** - Control (red), Significant (yellow), Disclosure (blue), SpecialRights (purple)
4. **Expandable breakdown** - By investor type, KYC status, or jurisdiction
5. **Drill-down list** - Paginated with filters for viewing all investors

---

## Quick Reference: Key Files

```
Session State:      rust/crates/ob-poc-ui/src/session.rs
Graph Renderer:     rust/crates/ob-poc-ui/src/graph/renderer.rs
Panel Layout:       rust/crates/ob-poc-ui/src/panels/mod.rs
REPL Commands:      rust/src/repl/commands.rs
Taxonomy:           rust/src/taxonomy/navigator.rs
Galaxy Nav:         rust/src/navigation/galaxy.rs
Voice Commands:     rust/src/navigation/voice.rs
State Persistence:  rust/crates/ob-poc-ui/src/persistence.rs
View Audit:         migrations/XXX_view_state_audit.sql
```

---

Generated: 2026-01-09
